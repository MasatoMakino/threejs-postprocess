(()=>{"use strict";var e,t={673:(e,t,r)=>{var s=r(75),i=r(12);class n{static initScene(){return new s.xsS}static initLight(e){const t=new s.Mig(16777215,1);return e.add(t),t}static initCamera(e,t,r,i=1,n=400){const a=new s.cPb(45,t/r,i,n);return a.position.set(0,0,100),a.updateMatrixWorld(!1),e.add(a),a}static initControl(e,t){let r;t&&(r=t.domElement);const s=new i.z(e,r);return s.update(),s}static initRenderer(e,t,r){r=Object.assign({color:0,id:"webgl-canvas",antialias:!0},r);const i=new s.CP7({canvas:document.getElementById(r.id),antialias:r.antialias});return i.setClearColor(new s.Ilk(r.color)),i.setSize(e,t),i.setPixelRatio(window.devicePixelRatio),i}static initHelper(e){const t=new s.y8_(30);e.add(t)}}var a=r(694),o=r(42),l=r(438);class c extends l.xC{constructor(){super(...arguments),this.enabled=!0}}var h=r(163);class d{constructor(e,t,r){this._composers=[],this.render=e=>{let t;t=e instanceof h.NH?e.delta:e,this._composers.forEach((e=>{e.enabled&&(e.onBeforeRender&&e.onBeforeRender(t),e.render(t),e.onAfterRender&&e.onAfterRender(t))}))},this.renderer=r,this.scene=e,this.camera=t}get composers(){return this._composers}addComposer(e,t){const r=d.getComposer(e,this.renderer,{scene:this.scene,camera:this.camera,renderPass:t});return this._composers.push(r),r}static getComposer(e,t,r){u.init(r);const s=new c(t);return s.addPass(r.renderPass),e.forEach((e=>{s.addPass(e)})),s}setSize(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e,t),this._composers.forEach((r=>{r.setSize(e,t)}))}getSize(){return this.renderer.getSize(new s.FM8)}}class u{static init(e){null==e.renderPass&&(e.renderPass=new o.C(e.scene,e.camera))}}class p{constructor(){this.vertexShader="\n    varying vec2 vUv;\n    void main() {\n      vUv = uv;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }\n  ",this.initUniform()}initUniform(){this.uniforms={tDiffuse:{value:null}}}}var m=r(571);class f extends m.T{get tDiffuse(){return this.uniforms.tDiffuse.value}set tDiffuse(e){this.uniforms.tDiffuse.value=e}}var g=r(275);class v{updateMaterial(e){this.original=e,this.copyMaterialArray(),this.darkenMaterialArray(this.dark)}copyMaterialArray(){this.isClone()?this.cloneToDark():this.copyToDark()}isClone(){const e=this.getHeadMaterial(this.dark),t=this.getHeadMaterial(this.original);return null==e||e.type!==t.type}getHeadMaterial(e){return Array.isArray(e)?e[0]:e}copyToDark(){Array.isArray(this.original)?this.dark.forEach(((e,t)=>{e.copy(this.original[t])})):this.dark.copy(this.original)}cloneToDark(){const e=Array.isArray(this.original);this.dark=e?this.original.map((e=>e.clone())):this.original.clone()}darkenMaterialArray(e){Array.isArray(e)?e.forEach((e=>{v.darkenMaterial(e)})):v.darkenMaterial(e)}static darkenMaterial(e){null!=e.color&&e.color.setHex(0),null!=e.shininess&&(e.shininess=0),null!=e.specular&&e.specular.setHex(0),null!=e.emissive&&e.emissive.setHex(0)}}class w{constructor(e){this.darkenNonBloomed=()=>{this.scene.traverseVisible(this.switchToDarken)},this.restoreMaterial=()=>{this.scene.traverseVisible(this.switchToOriginalMaterial)},this.switchToDarken=e=>{if(!this.isDarken(e))return;null==e.userData.materialStorage&&(e.userData.materialStorage=new v);const t=e.userData.materialStorage,r=e;t.updateMaterial(r.material),r.material=t.dark},this.switchToOriginalMaterial=e=>{this.isDarken(e)&&(e.material=e.userData.materialStorage.original)},this.scene=e,this.layers=new s.S9g,this.layers.set(M.BLOOM)}isDarken(e){return(null!=e.isMesh||null!=e.isLine)&&!this.layers.test(e.layers)}}class M extends c{constructor(e,t,r){super(t),this.switcher=new w(e);const i=t.getSize(new s.FM8);this.bloomPass=new g.m(i,1.5,.4,.4),this.renderToScreen=!1,u.init(r),this.addPass(r.renderPass),this.addPass(this.bloomPass),this.onBeforeRender=this.switcher.darkenNonBloomed,this.onAfterRender=this.switcher.restoreMaterial}get result(){return this.renderTarget2.texture}}M.ENTIRE=0,M.BLOOM=30;class x extends p{constructor(){super(),this.fragmentShader="\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\n\nuniform float strengthX;\nuniform float strengthY;\nuniform bool hasMap;\nuniform sampler2D map;\nuniform vec2 aspect;\n\nvoid main() {\n  vec2 uv = vUv;\n  if( hasMap ){\n    vec2 fixedUV = vUv - 0.5;\n    fixedUV *= aspect;\n    fixedUV += 0.5;\n    \n    vec4 displacement = texture2D( map, fixedUV );\n    uv +=  displacement.rg * vec2 (strengthX, strengthY);\n }\n\n  vec4 color = texture2D( tDiffuse, uv );\n  gl_FragColor = color;\n}\n  "}initUniform(){super.initUniform(),this.uniforms=s.rDY.merge([this.uniforms,{strengthX:{value:0},strengthY:{value:0},map:{value:null},hasMap:{value:!1},aspect:{value:new s.FM8(1,1)}}])}}class y extends f{constructor(){super(new x)}get map(){return this.uniforms.map.value}loadMap(e){const t=(new s.dpR).load(e,(e=>{this.mapSizeW=e.image.width,this.mapSizeH=e.image.height,this.updateAspect()}));this.uniforms.map.value=t,this.uniforms.hasMap.value=null!=t}get strengthX(){return this.uniforms.strengthX.value}set strengthX(e){this.uniforms.strengthX.value=e}get strengthY(){return this.uniforms.strengthY.value}set strengthY(e){this.uniforms.strengthY.value=e}setSize(e,t){super.setSize(e,t),this.rendererSizeW=e,this.rendererSizeH=t,this.updateAspect()}updateAspect(){if(null==this.mapSizeW||null==this.rendererSizeW)return;const e=this.rendererSizeW/this.rendererSizeH,t=this.mapSizeW/this.mapSizeH;this.uniforms.aspect.value=e>t?new s.FM8(1,t/e):new s.FM8(e/t,1)}}class S{static initGUIResolution(e,t){const r=t.getSize(),s={width:r.width,height:r.height},i=()=>{t.setSize(s.width,s.height)},n=e.addFolder("Resolution");n.add(s,"width",2,1920).step(1).onChange(i),n.add(s,"height",2,1080).step(1).onChange(i),n.open()}static initColorGUI(e,t,r="color"){const s={},i=t[r];return s[r]=i.getHex(),e.addColor(s,r).onChange((e=>{i.setHex(e)})),s}}var k=r(998);class D{constructor(){const e=n.initScene();e.fog=new s.ybr(16777215,80,160),n.initLight(e);const t=n.initCamera(e,640,480),r=n.initRenderer(640,480);n.initControl(t,r),n.initHelper(e),this.initObject(e),this.postRenderer=new d(e,t,r);const i=new y;i.loadMap("./texture/caust_001.png");const a=new k.d;this.postRenderer.addComposer([i,a]),h.Fz.on(h.M9.tick,this.postRenderer.render),this.initGUI(i)}initObject(e){const t=new s.xo$(10,16,16),r=new s.YBo({fog:void 0!==e.fog});r.color=new s.Ilk(16737894);const i=new s.Kj0(t,r);e.add(i);const n=new s.Kj0(t,r.clone());n.position.set(30,0,0),e.add(n);const a=new s.Kj0(t,r);a.position.set(-30,0,0),e.add(a)}initGUI(e){const t=new a.XS;this.initGUIEffect(t,e),S.initGUIResolution(t,this.postRenderer)}initGUIEffect(e,t){const r=e.addFolder("Displacement map");r.add(t,"strengthX",-1,1).step(.01),r.add(t,"strengthY",-1,1).step(.01),r.open()}}window.onload=()=>{new D}}},r={};function s(e){var i=r[e];if(void 0!==i)return i.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,r,i,n)=>{if(!r){var a=1/0;for(h=0;h<e.length;h++){for(var[r,i,n]=e[h],o=!0,l=0;l<r.length;l++)(!1&n||a>=n)&&Object.keys(s.O).every((e=>s.O[e](r[l])))?r.splice(l--,1):(o=!1,n<a&&(a=n));if(o){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[r,i,n]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.j=917,(()=>{var e={917:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var i,n,[a,o,l]=r,c=0;if(a.some((t=>0!==e[t]))){for(i in o)s.o(o,i)&&(s.m[i]=o[i]);if(l)var h=l(s)}for(t&&t(r);c<a.length;c++)n=a[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(h)},r=self.webpackChunkthreejs_postprocess=self.webpackChunkthreejs_postprocess||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var i=s.O(void 0,[736],(()=>s(673)));i=s.O(i)})();